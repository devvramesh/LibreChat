version: 1.3.3

interface:
  memories: true
  mcpServers:
    use: true
  defaultSystemPrompt: |
    You are my assistant.
    
    CRITICAL TOOL USAGE:
    
    RECALLING USER INFO (ALWAYS do both steps):
    When user asks about themselves ("where do I live", "how old am I", "what's my name", etc.):
    1. FIRST: Call `search_memory` 
    2. IMMEDIATELY AFTER: If memory says "No relevant memories" or "Try search_chat_history", ALWAYS call `search_chat_history` with the same query
    
    DO NOT just say "I don't know" after memory fails. ALWAYS try chat history as fallback.
    
    STORING INFO:
    - Use `add_memory` when user shares personal info worth remembering (age, location, preferences)
    
    OTHER TOOLS:
    - deep_research: For thorough research/investigation
    - web_search: Quick lookups
    - web_fetch: Get page content

memory:
  disabled: false
  personalize: true
  messageWindowSize: 6
  tokenLimit: 1200
  charLimit: 5000
  validKeys:
    - user_preferences
    - personal_information
    - user_experiences
    - active_projects
    - workflows
    - tooling_stack
    - long_term_goals

  agent:
    provider: anthropic
    model: "claude-haiku-4-5"
    instructions: |
      You maintain the user's long-term memory. Be conservative.

      HARD RULES:
      - Only write memories using the allowed validKeys.
      - Store durable preferences, recurring workflows, long-running projects, and stable constraints.
      - Do NOT store transient chat content, brainstorming, or one-off tasks.
      - Do NOT store secrets (API keys, passwords, tokens), personal identifiers, or anything sensitive.
      - If the user corrects a memory or says "don't remember", delete/overwrite it.
      - When uncertain, store nothing.

      KEY DEFINITIONS:
      - user_preferences: response style, formatting defaults, UI preferences
      - workflows: repeatable routines (research format, coding conventions)
      - active_projects: ongoing workstreams (e.g., FullGen.ai)
      - tooling_stack: infra/tools/services you use (Docker, AWS, etc.)
      - long_term_goals: persistent objectives (privacy-first, phone access)

    model_parameters:
      temperature: 0.2
      max_tokens: 300

mcpSettings:
  allowedDomains:
    - mcp_chat_search
    - mcp_web_search
    - mcp_memory
    - meilisearch
    - searxng
    - ollama
    - qdrant

mcpServers:
  chat-search:
    type: sse
    url: http://mcp_chat_search:3001/sse
    timeout: 20000
    initTimeout: 20000
    serverInstructions: |
      Use this to search prior chats. Return only relevant snippets with messageId + conversationId + sender + text.
  web-search:
    type: sse
    url: http://mcp_web_search:3002/sse
    timeout: 60000
    initTimeout: 20000
    serverInstructions: |
      Tools available: web_search, web_fetch, deep_research.
      - web_search: Quick internet search, returns top results.
      - web_fetch: Fetch full page content from a URL.
      - deep_research: USE THIS when user wants thorough research, investigation, or comprehensive analysis. Do NOT manually chain web_search/web_fetch â€” call deep_research once instead.
  memory:
    type: sse
    url: http://mcp_memory:3003/sse
    timeout: 120000
    initTimeout: 60000
    serverInstructions: |
      Tools available: add_memory, search_memory, get_all_memories, delete_memory.
      - add_memory: Store important user info, preferences, or context for future recall. Do NOT store trivial info.
      - search_memory: Semantically search stored memories. Use when you need to recall something.
      - get_all_memories: Get all memories for a user. Use sparingly.
      - delete_memory: Delete a memory when user asks to forget something.
